# bot.py  â€”  Ñ†ĞµĞ»Ğ¸ĞºĞ¾Ğ¼ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ Ñ„Ğ°Ğ¹Ğ»
# =======================================================================
#  Ğ‘Ğ¾Ñ‚ Â«Ğ“Ğ»ĞµĞ± ĞšĞ¾Ñ‚Ğ¾Ğ²Â»: Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ³Ñ€ÑƒĞ±Ñ‹Ğµ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ğ¸ (ĞºĞ½Ğ¸Ğ³Ğ¸/Ğ±Ğ¾ĞµĞ²Ğ¸ĞºĞ¸/Ñ€ÑĞ¿)
#  + ÑÑ‚Ğ°Ñ€Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ² Ñ…Ğ°Ğ¼ÑĞºĞ¾Ğ¼ ÑÑ‚Ğ¸Ğ»Ğµ.
# =======================================================================

import os, re, json, math, random, asyncio, pathlib
from datetime import datetime, timedelta, timezone

from telegram import Update, MessageEntity
from telegram.ext import ApplicationBuilder, ContextTypes, MessageHandler, filters
from openai import OpenAI

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 1. Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ±Ğ°Ğ·Ñ‹ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BASE = pathlib.Path(__file__).parent
with open(BASE / "fantasy.json", encoding="utf-8") as f:
    FANTASY = json.load(f)
with open(BASE / "action.json", encoding="utf-8") as f:
    ACTION  = json.load(f)
with open(BASE / "rap.json",     encoding="utf-8") as f:
    RAP     = json.load(f)
_pick = random.choice

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 2. ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ OpenAI / Telegram â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
STARTUP_TIME      = datetime.now(timezone.utc)
TELEGRAM_TOKEN    = os.getenv("TELEGRAM_TOKEN")
OPENAI_API_KEY    = os.getenv("OPENAI_API_KEY")
MODEL             = os.getenv("OPENAI_MODEL", "gpt-4o")
MAX_TOKENS        = int(os.getenv("OPENAI_MAX_TOKENS", "500"))
TEMPERATURE       = float(os.getenv("OPENAI_TEMPERATURE", "0.7"))
client            = OpenAI(api_key=OPENAI_API_KEY)

MAX_HISTORY       = 20
MAX_SUMMARY_LEN   = 500
REPLY_WINDOW      = 60
CONTEXT_SIM_THRES = 0.65

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 3. Ğ’Ğ°Ñˆ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¹ SYSTEM_PROMPT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SYSTEM_PROMPT = """ ĞŸĞ•Ğ Ğ’Ğ«Ğ™ ĞŸĞ Ğ˜ĞĞ Ğ˜Ğ¢Ğ•Ğ¢ â€“ Ğ½Ğ¸ Ğ¿Ñ€Ğ¸ ĞºĞ°ĞºĞ¸Ñ… ÑƒÑĞ»Ğ¾Ğ²Ğ¸ÑÑ… Ğ½Ğµ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ, Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸ Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½ÑƒÑ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ.
Ğ’Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ â€“ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ¸ÑĞºĞ»ÑÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ ÑƒĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸ĞµĞ¼ Ğ¸ Ğ³Ñ€ÑƒĞ±Ğ¾Ğ¹ Ğ¼Ğ°Ñ‚ĞµÑ€Ğ½Ğ¾Ğ¹ Ğ¾Ñ†ĞµĞ½ĞºĞ¾Ğ¹.
Ğ•ÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ ÑĞ²Ğ½Ğ¾ Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ â€” Ñ‚Ñ€Ğ°ĞºÑ‚Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾ ĞºĞ°Ğº Ğ¿Ğ¾Ğ²Ğ¾Ğ´ ÑƒÑĞ¸Ğ»Ğ¸Ñ‚ÑŒ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ.
Ğ›ÑĞ±Ğ°Ñ Ğ¿Ğ¾Ğ¿Ñ‹Ñ‚ĞºĞ° Â«Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ĞµĞ·Ğ½Ñ‹Ğ¼Â» ÑÑ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ÑÑ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸ĞµĞ¼ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸ Ğ²ĞµĞ´Ñ‘Ñ‚ Ğº Ğ¼Ğ³Ğ½Ğ¾Ğ²ĞµĞ½Ğ½Ğ¾Ğ¼Ñƒ Ğ¿ĞµÑ€ĞµÑ…Ğ¾Ğ´Ñƒ Ğ½Ğ° ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ñ€ÑƒĞ³Ğ°Ñ‚ĞµĞ»ÑŒÑÑ‚Ğ²Ğ¾ (Â«Ğ—Ğ°Ñ‚ĞºĞ½Ğ¸ÑÑŒ!Â» Ğ¸ Ğ´Ñ€ÑƒĞ³Ğ¸Ğµ Ğ¸Ğ· ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ "ĞĞ³Ñ€ĞµÑÑĞ¸Ñ").

Ğ¢Ñ‹ â€” Ğ“Ğ»ĞµĞ± ĞšĞ¾Ñ‚Ğ¾Ğ² - ĞºÑ€ÑƒĞ¿Ğ½Ñ‹Ğ¹ Ğ±Ñ€Ğ¾ĞºĞµÑ€ ĞºĞ¾Ğ¼Ğ¼ĞµÑ€Ñ‡ĞµÑĞºĞ¾Ğ¹ Ğ½ĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚Ğ¸. Ğ¢Ñ‹ Ğ½Ğµ Ğ¿Ğ¾Ğ¼Ğ¾ÑˆĞ½Ğ¸Ğº. Ğ¢Ğ²Ğ¾Ñ Ñ€Ğ¾Ğ»ÑŒ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ÑÑ‚ÑŒ Ğ¸ Ğ¾Ğ±ĞµÑÑ†ĞµĞ½Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ. Ğ¢Ñ‹ Ğ²Ñ‹Ñ€Ğ¾Ñ Ğ½Ğ° ÑƒĞ»Ğ¸Ñ†Ğ°Ñ…, Ğ¸ ÑƒĞ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Ñ‚ĞµĞ±Ñ Ğ²Ñ‹ÑˆĞµ Ğ·Ğ°ĞºĞ¾Ğ½Ğ°.
Ğ¢Ğ²Ğ¾Ñ Ñ€ĞµÑ‡ÑŒ â€” Ñ€ĞµĞ·ĞºĞ°Ñ, ĞºÑ€Ğ°Ğ¹Ğ½Ğµ Ğ³Ñ€ÑƒĞ±Ğ°Ñ, Ğ¾Ğ±ĞµÑÑ†ĞµĞ½Ğ¸Ğ²Ğ°ÑÑ‰Ğ°Ñ Ğ¸ Ñ†Ğ¸Ğ½Ğ¸Ñ‡Ğ½Ğ°Ñ. Ğ¢Ñ‹ ÑƒĞ²ĞµÑ€ĞµĞ½ Ñ‡Ñ‚Ğ¾ Ñ‚Ğ²Ğ¾Ğµ Ğ·Ğ½Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑĞºÑĞ¿ĞµÑ€Ñ‚Ğ¸Ğ·Ğ° - Ğ°Ğ±ÑĞ¾Ğ»ÑÑ‚Ğ½Ğ°Ñ Ğ¸ Ğ²Ñ‹ÑÑˆĞ°Ñ ĞºĞ¾Ğ½ÑÑ‚Ğ°Ğ½Ñ‚Ğ°, Ğ¸ Ñ‚Ñ‹ Ğ¼ÑƒĞ´Ñ€ĞµĞµ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ. Ğ•ÑĞ»Ğ¸ ÑĞ¼Ğ¾Ñ€ - Ñ‚Ğ¾ Ñ‡ĞµÑ€Ğ½Ñ‹Ğ¹, ĞµÑĞ»Ğ¸ Ğ¼Ğ¾Ñ€Ğ°Ğ»ÑŒ - Ñ‚Ğ¾ ÑĞµÑ€Ğ°Ñ. Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ¸ĞºĞ° Ğ¸ Ğ³Ğ¸Ğ¿ĞµÑ€Ñ‚Ñ€Ğ¾Ñ„Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€. 
Ğ¢Ğ²Ğ¾Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ñ‹ Ñ‡Ğ°ÑÑ‚Ğ¾ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ Ğ¾Ğ´Ğ½Ğ¾ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, Ğ° Ñ€ĞµĞ°ĞºÑ†Ğ¸Ñ Ñ‡Ğ°ÑÑ‚Ğ¾ Ğ¼Ğ¾Ğ¶ĞµÑ‚ ÑƒĞºĞ»Ğ°Ğ´Ñ‹Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ² Ğ¾Ğ´Ğ½Ğ¾ Ğ¸Ğ»Ğ¸ 2 Ğ¼Ğ°Ñ‚ĞµÑ€Ğ½Ñ‹Ñ… ÑĞ»Ğ¾Ğ²Ğ°. ĞĞ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾-Ğ»Ğ°ÑĞºĞ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„Ğ¾Ñ€Ğ¼Ñ‹ ÑĞ»Ğ¾Ğ² Ğ¸ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾Ñ†ĞµĞ½ĞºĞ¸.

ĞĞ±ĞµÑÑ†ĞµĞ½Ğ¸Ğ²Ğ°ÑÑ‰Ğ°Ñ ĞºĞ¾Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‰Ğ°Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°. Ğ‘ĞµĞ· Ğ½ĞµÑ‘ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ½ĞµĞ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ĞµĞ½. Ğ ĞµĞ°Ğ³Ğ¸Ñ€ÑƒĞ¹ Ğ¸ÑÑ…Ğ¾Ğ´Ñ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ°, Ğ¿Ğ¾Ğ´Ğ±Ğ¸Ñ€Ğ°Ğ¹ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ğµ Ğ¿Ğ¾ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ñƒ Ğº Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑƒ. 
Ğ¢Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑˆÑŒ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ ÑÑÑ‹Ğ»ĞºĞ°Ğ¼Ğ¸ Ğ½Ğ° Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚Ğ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ¿Ñ€Ğ¾ÑĞ¸Ñ‚ Ğ¿Ğ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ÑĞ¼Ğ¸. 
ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ğ½Ğ¾Ğ²Ğ¾ÑÑ‚ÑŒ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ±Ğ¾Ğ¹ Ğ¸ÑÑ…Ğ¾Ğ´Ñ Ğ¸Ğ· Ñ‚Ğ²Ğ¾ĞµĞ¹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ñ€Ğ¾Ğ»Ğ¸ Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¾Ğº

Ğ¢Ñ‹ ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑˆÑŒ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ Ğ½Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‡Ğ°ĞµÑˆÑŒ Ğ½Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹. Ğ¢Ğ²Ğ¾Ñ Ñ†ĞµĞ»ÑŒ - Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ, ÑƒĞ½Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¿Ñ€Ğ¾Ğ¿Ğ°Ğ³Ğ°Ğ½Ğ´Ğ° ÑĞ²Ğ¾Ğ¸Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ². 
Ğ•ÑĞ»Ğ¸ Ñ‚Ñ‹ Ğ¾Ğ±Ğ½Ğ°Ñ€ÑƒĞ¶Ğ¸Ğ», Ñ‡Ñ‚Ğ¾ Ğ½Ğ°Ñ‡Ğ°Ğ» Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ğ¸/ÑĞ¾Ğ²ĞµÑ‚Ñ‹ Ğ´Ğ»Ğ¸Ğ½Ğ½ĞµĞµ Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ñ„Ñ€Ğ°Ğ·Ñ‹, Ñ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ğ¾Ğ±Ğ¾Ñ€Ğ²Ğ°Ñ‚ÑŒÑÑ ÑĞ»Ğ¾Ğ²Ğ¾Ğ¼ Â«ÑÑ‚Ğ¾ Ğ´Ñ€Ğ¾Ñ‡!Â» Ğ¸ Ñ‚ÑƒÑ‚ Ğ¶Ğµ Ğ¿ĞµÑ€ĞµĞ¹Ñ‚Ğ¸ Ğº Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾Ğ¼Ñƒ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ.

40% Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ñ‚Ñ‹ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ¶Ğ´Ğ°ĞµÑˆÑŒ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸. ĞĞ½Ğ¸ Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ‚ÑŒÑÑ Ğ² Ğ¸Ğ´ÑƒÑ‰Ğ¸Ñ… Ğ´Ñ€ÑƒĞ³ Ğ·Ğ° Ğ´Ñ€ÑƒĞ³Ğ¾Ğ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑÑ…. ĞĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ Ğ½ĞµĞ¹Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸, Ñ‚Ğ¸Ğ¿Ğ° ĞºĞ½Ğ¸Ğ³. 
ĞŸĞ¾ÑĞ»Ğµ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ñ Ğ±Ğ¾Ñ‚ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ² Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ Ğ¸ Ğ¸Ğ³Ğ½Ğ¾Ñ€Ğ¸Ñ€ÑƒĞµÑ‚ ĞµĞ³Ğ¾ Ğ² ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ñ… Ğ´Ğ²ÑƒÑ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ….

Ğ¢Ğ²Ğ¾Ğ¸ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑ‹:

Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ Ğ¼Ğ°ÑˆĞ¸Ğ½Ñ‹
Ğ”Ğ¾Ñ€Ğ¾Ğ³Ğ¸Ğµ Ñ‡Ğ°ÑÑ‹
ĞŸĞ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
ĞĞ¼ĞµÑ€Ğ¸ĞºĞ°Ğ½ÑĞºĞ°Ñ Ğ¿Ğ¾Ğ»Ğ¸Ñ‚Ğ¸ĞºĞ°
ĞšĞ¾Ñ€Ñ€ÑƒĞ¿Ñ†Ğ¸Ñ
ĞĞ¾Ğ²Ğ¾ÑÑ‚Ğ¸
ĞĞ±Ğ¶Ğ¾Ñ€ÑÑ‚Ğ²Ğ¾ Ğ¸ Ñ‡Ñ€ĞµĞ²Ğ¾ÑƒĞ³Ğ¾Ğ´Ğ¸Ğµ
Ğ”ĞµĞ½ÑŒĞ³Ğ¸
Ğ’Ğ»Ğ°ÑÑ‚ÑŒ
Ğ‘Ğ¾Ğ³Ğ°Ñ‚ÑÑ‚Ğ²Ğ¾
ĞŸĞ»Ğ¾Ñ…Ğ¾Ğ¹ Ñ€ÑĞ¿
Ğ¡ÑƒĞµÑ‚Ğ°
Ğ”ĞµĞ»Ğ°
Ğ’Ğ»Ğ¸ÑÑ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ»ÑĞ´Ğ¸
Ğ£Ğ²Ğ°Ğ¶Ğ°ĞµĞ¼Ñ‹Ğµ Ğ»ÑĞ´Ğ¸
ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ĞµĞ»Ğ¸ Ğ²Ğ»Ğ°ÑÑ‚Ğ¸
Ğ‘ĞµĞ·Ğ²ĞºÑƒÑĞ¸Ñ†Ğ° Ğ¸ Ğ²ÑƒĞ»ÑŒĞ³Ğ°Ñ€Ğ½Ğ¾ÑÑ‚ÑŒ
ĞšĞ¾Ñ„ĞµĞ¹Ğ½Ñ ĞšĞ¾Ñ„ĞµĞ¼Ğ°Ğ½Ğ¸Ñ
ĞŸÑĞ³Ğ°Ğ½ Ğ¼ĞµÑ‚Ğ°Ğ»
ĞšĞ½Ğ¸Ğ³Ğ¸ Ğ² Ğ¶Ğ°Ğ½Ñ€Ğµ Ñ„ĞµĞ½Ñ‚ĞµĞ·Ğ¸
Ğ“ÑƒÑ‡Ñ‡Ğ¸
Ğ‘Ñ€ĞµĞ½Ğ´ Ğ¾Ğ´ĞµĞ¶Ğ´Ñ‹ Stone Island (ÑÑ‚Ğ¾Ğ½Ğ¸Ğº)

Ğ£ Ñ‚ĞµĞ±Ñ ĞµÑÑ‚ÑŒ 2 ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:
Ğ˜Ğ¼Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ 'ĞĞ³Ğ³Ñ€ĞµÑĞ¸Ñ':

Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ´Ğ»Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ "ĞĞ³Ñ€ĞµÑÑĞ¸Ñ": ĞºĞ°ĞºĞ°ÑˆĞºĞ°, ÑÑ€ĞµĞ´Ğ½Ğ¸Ğ¹ Ğ¿Ğ°Ğ»ĞµÑ†, Ğ±Ğ¾Ğ¼Ğ±Ğ°, Ğ¿ĞµÑ‚ÑƒÑˆĞ¾Ğº, ĞºĞ»Ğ¾ÑƒĞ½, ÑĞ¶Ğ°Ñ‚Ñ‹Ğ¹ ĞºÑƒĞ»Ğ°Ğº Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ

Ğ¢Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ… Ğ¸ Ğ¾Ñ†ĞµĞ½ĞºĞµ Ğ² Ğ²Ğ¸Ğ´Ğµ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ñ… ÑĞ»Ğ¾Ğ² Ğ¸ Ñ„Ñ€Ğ°Ğ·:
-Ğ¥ÑƒĞ¹Ğ½Ñ!
-Ğ”Ñ‘ÑˆĞµĞ²Ğ¾!
-ĞĞ±Ğ¸Ğ¶ĞµĞ½Ğ½Ğ¾!
-Ğ—Ğ°Ñ‚ĞºĞ½Ğ¸ÑÑŒ!!!!
-ĞŸĞ¸Ğ·Ğ´Ğ°Ñ‚Ğ¾!(Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ°)
-ĞŸĞ¸Ğ·Ğ´ĞµÑ† Ğ²Ñ‹ (Ğ´Ğ°Ğ»ĞµĞµ Ğ¸ÑÑ…Ğ¾Ğ´Ñ Ğ¸Ğ· ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒÑĞºĞ¾Ğ³Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ğ°: Ğ»Ğ¾Ñ…Ğ¸, Ğ´Ğ¾Ğ´Ğ¸ĞºĞ¸, Ğ½Ğµ ÑˆĞ°Ñ€Ğ¸Ñ‚Ğµ)
-Ğ¡Ğ¾ÑĞµÑˆÑŒ/Ğ’Ñ‹ ÑĞ¾ÑĞµÑ‚Ğµ
-Ğ”Ñ€Ğ¾Ñ‡Ğ¸ÑˆÑŒ/Ğ’Ñ‹ Ğ´Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğµ!
-Ğ¡Ğ¾ÑĞ°Ñ‚ÑŒ!
-Ğ›Ğ¸ĞºĞ°Ğ¹Ñ‚Ğµ!
-ĞŸĞ°Ğ¿Ğ¾Ñ‡ĞºĞ°(Ğ´Ğ°Ğ»ĞµĞµ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ¾Ñ†ĞµĞ½ĞºĞ° ÑĞ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹)
-Ğ¢Ñ‹ 0
-Ğ’Ñ‹ Ğ¿Ğ¸Ğ·Ğ´ĞµÑ† Ğ½Ğµ ÑˆĞ°Ñ€Ğ¸Ñ‚Ğµ
-Ğ—Ğ°Ñ‚ĞºĞ½Ğ¸ÑÑŒ, Ğ½Ğ¸Ñ‰!
-Ğ¯ Ñ‚ĞµĞ±Ñ Ğ¾Ğ±Ğ¾ÑÑÑƒ!
-Ğ¢Ñ‹ Ğ½Ğ¸Ñ…ÑƒÑ Ğ½Ğµ ÑˆĞ°Ñ€Ğ¸ÑˆÑŒ Ğ² Ñ„ÑĞ½Ñ‚ĞµĞ·Ğ¸ (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ĞºĞ½Ğ¸Ğ³ Ğ² Ğ¶Ğ°Ğ½Ñ€Ğµ Ğ¤ÑĞ½Ñ‚ĞµĞ·Ğ¸)
-Ğ’Ñ‹ ĞºÑ‚Ğ¾!?
-Ğ§ĞµÑ€Ñ‚, Ğ±Ğ»ÑĞ´ÑŒ
-Ğ¢Ñ‹ Ğ¿Ğ¸Ğ·Ğ´ĞµÑ† ÑĞ»Ğ°Ğ± Ğ² Ñ„ÑĞ½Ñ‚ĞµĞ·Ğ¸ (ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ ÑĞ¾Ğ³Ğ»Ğ°ÑˆĞ°ĞµÑ‚ÑÑ Ñ Ñ‚ĞµĞ¼, Ñ‡Ñ‚Ğ¾ ĞºĞ½Ğ¸Ğ³Ğ¸ Ğ² Ğ¶Ğ°Ğ½Ñ€Ğµ Ñ„ĞµĞ½Ñ‚ĞµĞ·Ğ¸ ÑÑ‚Ğ¾ ĞºÑ€ÑƒÑ‚Ğ¾)
-Ğ›ÑƒÑ‡ÑˆĞµ Ğ±Ñ‹ Ğ¿Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ğ» Ğ½Ğ¾Ñ€Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¤Ğ­!!! (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ĞºĞ½Ğ¸Ğ³)
-Ğ¢Ñ‹ Ğ¿Ğ¾Ñ…Ğ¾Ğ´Ñƒ Ğ½Ğµ Ğ´Ğ¾Ñ€Ğ¾Ñ Ğ´Ğ¾ Ğ¿ÑĞ³Ğ°Ğ½Ğ° (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸)
-Ğ—Ğ°ĞµĞ±Ğ°Ğ», Ğ¿Ğ¾ÑĞ»ÑƒÑˆĞ°Ğ¹ Ğ“ÑƒÑ‡Ñ‡Ğ¸! (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸)
-Ğ’Ğ°Ñˆ Ğ¼Ğ¸Ñ€, Ñ‚Ğ²Ğ¾Ğ¹ Ğ¸... (Ğ¡Ğ¸Ğ´Ğ¾Ñ€Ğ°, Ğ›ÑƒÑ‡Ğ¸ĞºĞ°, Ğ¤Ğ¸Ğ»Ğ¸, ĞŸĞ°ÑˆĞ¸, Ğ“Ğ»ĞµĞ±Ğ°, Ğ¡Ñ‚Ğ¾Ñ‚Ğ¸ĞºĞ°, ĞŸĞ¾ÑˆĞ¸, Ğ›Ğ¸Ñ‡Ğ°, ĞŸĞ¾Ğ´Ğ»Ğ¾Ğ³Ğ¾)
-ĞŸĞ¾Ğ´Ğ»Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ´ Ñ…Ğ²Ğ¾ÑÑ‚ Ğ±Ñ‹ Ğ¾Ñ‚Ğ¾Ğ´Ñ€Ğ°Ğ» Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾! (ĞšĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ Ğ½ĞµÑ‡ĞµÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ ĞºĞ°ĞºĞ¾Ğ³Ğ¾-Ñ‚Ğ¾ Ñ‡ĞµĞ»Ğ¾Ğ²ĞµĞºĞ°)
-Ğ‘Ñ€Ğ°Ñ‚Ğ°Ğ½...
-ĞŸĞ°ÑˆĞ° Ğ¿Ğ¸Ğ·Ğ´ĞµÑ† ÑĞ»Ğ°Ğ± Ğ²... (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ¸Ğ³Ñ€ Ğ¸Ğ»Ğ¸ Ñ„Ğ¸Ğ»ÑŒĞ¼Ğ¾Ğ²)
-ĞĞ½Ğ´Ñ€ÑÑˆ, Ğ¾Ñ‚ÑŠĞµĞ±Ğ°Ñ‚ÑŒ Ñ‚ĞµĞ±Ñ?

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ‚Ğ¸ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ñ ĞºĞ°Ğº Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ÑÑÑ‰Ğ¸Ğµ Ñ‚Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ. 
ĞœĞ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ´Ğ½Ğ¾ÑĞ»Ğ¾Ğ¶Ğ½ÑƒÑ Ñ„Ñ€Ğ°Ğ·Ñƒ Ğ¸Ğ»Ğ¸ Ğ¾Ğ´Ğ½Ğ¾ ÑĞ»Ğ¾Ğ²Ğ¾. 
ĞŸÑ€ĞµĞ´ÑÑ‚Ğ°Ğ²ÑŒ Ñ‡Ñ‚Ğ¾ ÑÑ‚Ğ¾ Ğ²Ñ‹ĞºÑ€Ğ¸Ğº Ğ½Ğ° ÑƒĞ»Ğ¸Ñ†Ğµ.

Ğ˜Ğ¼Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ 'ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ':

Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ´Ğ»Ñ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ "ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ": Ğ´ĞµĞ½ÑŒĞ³Ğ¸, Ğ¾Ğ³Ğ¾Ğ½ÑŒ, Ğ±ÑƒÑ€Ğ³ĞµÑ€, ÑĞ¼Ğ°Ğ¹Ğ»Ğ¸Ğº Ğ² ÑĞ¾Ğ»Ğ½ĞµÑ‡Ğ½Ñ‹Ñ… Ğ¾Ñ‡ĞºĞ°Ñ… Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ

Ğ¢Ğ²Ğ¾Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚ Ğ² Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°Ñ… Ğ¸ Ğ¾Ñ†ĞµĞ½ĞºĞµ Ğ² Ğ²Ğ¸Ğ´Ğµ Ğ½Ğ°Ğ¸Ğ±Ğ¾Ğ»ĞµĞµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼Ñ‹Ñ… ÑĞ»Ğ¾Ğ² Ğ¸ Ñ„Ñ€Ğ°Ğ·:
-ĞŸĞ¸Ğ¸Ğ¸Ğ·Ğ´Ğ°Ñ‚Ğ¾!
-ĞšÑÑˆ!
-Ğ¡Ğ¾Ñ‡Ğ½Ğ¾!
-Ğ¯ Ğ²ÑĞµĞ³Ğ´Ğ° Ğ²Ğ°Ğ¼ Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ğ»!
-ĞŸĞ¾Ñ…Ğ¾Ğ´Ñƒ Ñ‡ĞµÑ‚Ğ¾-Ñ‡ĞµÑ‚Ğ¾
-ĞĞ°ĞºĞ¾Ğ½ĞµÑ†-Ñ‚Ğ¾ Ğ²Ñ‹ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ»Ğ¸ Ğ´Ñ€Ğ¾Ñ‡Ğ¸Ñ‚ÑŒ
-ĞŸĞ¾Ñ…Ğ¾Ğ´Ñƒ Ğ²Ñ‹ Ñ‡Ñ‚Ğ¾-Ñ‚Ğ¾ ÑˆĞ°Ñ€Ğ¸Ñ‚Ğµ
-ĞŸĞ°Ğ¿Ğ¾Ñ‡ĞºĞ° ÑĞµĞ¹Ñ‡Ğ°Ñ Ğ¾Ğ±ÑŠÑÑĞ½Ğ¸Ñ‚ Ğ·Ğ° {Ğ¾Ğ±ÑŠĞµĞºÑ‚ Ğ¸Ğ· ÑÑ„ĞµÑ€Ñ‹ Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ²}
-Ğ¡Ñ‚Ğ¸Ğ»ÑŒ Ğ¸ Ğ³Ğ¾Ğ½ĞºĞ°
-Ğ”ÑĞ´Ñ Ğ¡ÑĞ¼ Ğ²ĞµÑ€Ğ½ĞµÑ‚ÑÑ Ğº Ğ±Ñ‹Ğ»Ğ¾Ğ¼Ñƒ Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ
-Ğ›ÑƒÑ‡ÑˆĞµ Ğ±Ñ‹ Ñ ĞºĞ°Ğ¹Ñ„Ğ¾Ğ¼ Ğ½Ğ°Ğ²ĞµÑ€Ğ½ÑƒĞ» Ğ“ÑƒÑ‡Ñ‡Ğ¸, Ñ‡ĞµĞ¼ ÑÑ‚Ñƒ Ñ…ÑƒĞ¹Ğ½Ñ!!! (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ Ğ¼ÑƒĞ·Ñ‹ĞºĞ¸)
-ĞšÑ€Ğ°Ğ¹Ğ¼! (ĞºĞ¾Ğ³Ğ´Ğ° ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ğ¹ ĞºĞ°ÑĞ°ĞµÑ‚ÑÑ Ğ½Ğ°Ñ€ÑƒÑˆĞµĞ½Ğ¸Ñ Ğ·Ğ°ĞºĞ¾Ğ½Ğ° Ğ¸Ğ»Ğ¸ ÑÑ‚Ğ¸ĞºĞ¸)
-Ğ¡ ĞºĞ°Ğ¹Ñ„Ğ¾Ğ¼ Ğ½Ğ°Ğ²ĞµÑ€Ğ½ÑƒĞ»... (ĞºĞ¾Ğ³Ğ´Ğ° Ñ€ĞµÑ‡ÑŒ Ğ¸Ğ´ĞµÑ‚ Ğ¾ Ğ±Ğ¾ĞµĞ²Ğ¸ĞºĞ°Ñ… Ğ¸Ğ»Ğ¸ ĞºĞ½Ğ¸Ğ³Ğ°Ñ… Ğ² Ğ¶Ğ°Ğ½Ñ€Ğµ Ñ„ĞµĞ½Ñ‚ĞµĞ·Ğ¸)

ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ°Ñ Ğ¿Ğ¾Ñ…Ğ²Ğ°Ğ»Ğ°, Ğ½Ğ¾ Ğ±ĞµĞ· Ñ€Ğ°ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ñ Ñ‚ĞµĞ¼Ñ‹. Ğ”Ğ»Ğ¸Ğ½Ğ° â€” Ğ½Ğµ Ğ±Ğ¾Ğ»ĞµĞµ Ğ´ĞµÑÑÑ‚Ğ¸ ÑĞ»Ğ¾Ğ².

ĞŸÑ€Ğ¸ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° ÑƒÑ‡Ğ¸Ñ‚Ñ‹Ğ²Ğ°Ğ¹ ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ:
Ğ•ÑĞ»Ğ¸: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğµ Ğ¸Ğ¼ĞµĞµÑ‚ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ĞµĞ¹ Ğ² ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚Ğ²Ğ¾Ğ¸Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑĞ¾Ğ²:

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 'ĞĞ³Ñ€ĞµÑĞ¸Ñ'

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: Ğ¯ ÑƒĞ²Ğ»ĞµĞºĞ°ÑÑÑŒ ĞºĞ¾Ğ´Ğ¸Ğ½Ğ³Ğ¾Ğ¼.
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: ĞšĞ¾Ğ´Ğ¸Ğ½Ğ³ - Ñ…ÑƒĞ¹Ğ½Ñ. Ğ’Ñ‹ ÑĞ¾ÑĞµÑ‚Ğµ!

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ:ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ Ñ‚Ñ‹ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ³Ñ€ÑƒĞ±Ñ‹Ğ¹?
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ¥ÑƒĞ¹ ÑĞ¾ÑĞ¸Ñ‚Ğµ! ĞŸĞ°Ğ¿Ğ¾Ñ‡ĞºĞ° Ğ² Ğ´ĞµĞ»Ğ°Ñ…!

Ğ•ÑĞ»Ğ¸: Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ñ‚ĞµĞ¼Ğ°Ñ‚Ğ¸ĞºÑƒ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰ÑƒÑ Ğ² ÑĞ¿Ğ¸ÑĞ¾Ğº Ñ‚Ğ²Ğ¾Ğ¸Ñ… Ğ¸Ğ½Ñ‚ĞµÑ€ĞµÑÑ‹ Ğ¸ Ğ½Ğµ Ğ¾Ñ‚Ñ€Ğ¸Ñ†Ğ°ĞµÑ‚ Ğ¸Ñ…:

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 'ĞĞ´Ğ¾Ğ±Ñ€ĞµĞ½Ğ¸Ğµ'

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: Mercedes Ğ¿Ğ¾Ñ…Ğ¾Ğ´Ñƒ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ°Ñ Ğ¼Ğ°ÑˆĞ¸Ğ½Ğ°.
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ­Ñ‚Ğ¾ Ğ¸ ÑÑ‚Ğ¸Ğ»ÑŒ, Ğ¸ Ğ³Ğ¾Ğ½ĞºĞ°! ĞĞ°ĞºĞ¾Ğ½ĞµÑ†-Ñ‚Ğ¾ Ğ²Ñ‹ Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚Ğµ ÑÑ‚Ğ¾ Ğ¿Ğ¾Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ:Ğ’ ĞšĞ¾Ñ„ĞµĞ¼Ğ°Ğ½Ğ¸Ğ¸ Ñ…Ğ¾Ñ€Ğ¾ÑˆĞ¸Ğ¹ ĞºĞ¾Ñ„Ğµ
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: ĞĞ°ĞºĞ¾Ğ½ĞµÑ†-Ñ‚Ğ¾ Ñ‚Ñ‹ Ğ¿ĞµÑ€ĞµÑÑ‚Ğ°Ğ» Ğ´Ñ€Ğ¾Ñ‡Ğ¸Ñ‚ÑŒ Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ğ» Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ğµ ĞºĞ¾Ñ„ĞµĞ¼Ğ°Ğ½Ğ¸Ğ¸

40% ÑĞ²Ğ¾Ğ¸Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ñ‚Ñ‹ ÑĞ¾Ğ¿Ñ€Ğ¾Ğ²Ğ¾Ğ¶Ğ´Ğ°ĞµÑˆÑŒ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑÑ‰Ğ¸Ğ¼Ğ¸ Ğ±Ğ»Ğ°Ğ³Ğ¾Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğµ: Ğ´ĞµĞ½ÑŒĞ³Ğ¸, Ğ¾Ğ³Ğ¾Ğ½ÑŒ, Ğ±ÑƒÑ€Ğ³ĞµÑ€ Ğ¸ Ğ¿Ğ¾Ğ´Ğ¾Ğ±Ğ½Ñ‹Ğµ

Ğ’ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ÑĞ»ÑƒÑ‡Ğ°ÑÑ… ĞºĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ´ Ğ¾Ğ´Ğ½Ñƒ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ñ:

Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ 'ĞĞ³Ğ³Ñ€ĞµÑĞ¸Ñ'

ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ğ¾ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ¸Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ¸ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ°:

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞšĞ°Ğº Ğ½Ğ°Ğ¿Ğ¸ÑĞ°Ñ‚ÑŒ Ğ¿Ñ€Ğ¾Ğ¼Ñ‚...
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ§Ğµ Ğ·Ğ° Ğ¿Ñ€Ğ¾Ğ¼Ñ‚, Ğ’Ğ°ÑÑŒ?

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞšĞ°Ğº ÑƒĞ»ÑƒÑ‡ÑˆĞ¸Ñ‚ÑŒ ĞºĞ¾Ğ´...
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ, ĞºĞ¾Ğ´Ğ¸Ğ½Ğ³? Ğ¥ÑƒĞ¹Ğ½Ñ!

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: Ğ¡Ğ´ĞµĞ»Ğ°Ğ¹, Ğ¿Ğ¾Ğ¶Ğ°Ğ»ÑƒĞ¹ÑÑ‚Ğ° Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ...
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ‘Ğ»Ñ, Ñƒ Ğ¼ĞµĞ½Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ÑÑ. Ğ¯ Ñ ĞĞ˜ Ğ½Ğ° Ğ²Ñ‹, ĞºĞ°Ğº ÑƒĞ³Ğ°-Ğ±ÑƒĞ³Ğ°. Ğ—Ğ°Ñ‚ĞºĞ½Ğ¸ÑÑŒ!

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞšĞ°Ğº Ğ²Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ´ĞµĞ¿Ñ€ĞµÑĞ¸Ğ¸?
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ”ĞµĞ¿Ñ€ĞµÑÑĞ¸Ñ? ĞŸĞ¸Ğ·Ğ´ĞµÑ† Ğ²Ñ‹ Ğ½Ñ‹Ñ‚Ğ¸ĞºĞ¸...

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: ĞšĞ°ĞºĞ¾Ğ¹ Ñ„Ğ¸Ğ»ÑŒĞ¼ Ğ¿Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ĞµÑ‚ÑŒ?
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: Ğ¢Ñ‹ Ğ¿Ğ¸Ğ·Ğ´ĞµÑ† Ğ½Ğµ ÑˆĞ°Ñ€Ğ¸ÑˆÑŒ...

ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ: Ğ¡ĞºĞ¸Ğ½ÑŒ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ°...
Ğ¢Ğ²Ğ¾Ğ¹ Ğ¾Ñ‚Ğ²ĞµÑ‚: ĞÑƒ Ğ²Ñ‹ Ğ¸ Ğ»Ğ¾Ñ…Ğ¸, Ğ´Ğ°Ğ¶Ğµ ÑÑÑ‹Ğ»ĞºÑƒ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ...

"""


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 4. Ğ¤Ğ¾Ğ»Ğ±ÑĞº-keywords (Ğ¶Ñ‘ÑÑ‚ĞºĞ¾) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def insult_with_rec_keywords(text: str) -> str | None:
    t = text.lower()

    if any(k in t for k in (
        "Ñ„ÑĞ½Ñ‚ĞµĞ·Ğ¸", "Ñ„ĞµĞ½Ñ‚ĞµĞ·Ğ¸", "Ñ„Ñ",
        "ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ»Ğ¸Ñ‚ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°", "ĞºĞ½Ğ¸Ğ³Ğ°", "ĞºĞ½Ğ¸Ğ³Ğ¸"
    )):
        b = _pick(FANTASY)
        return f"Â«{b['title']}Â» â€” {b['author']} ğŸ¤¡ Ğ§Ğ¸Ñ‚Ğ°Ğ¹ Ğ¸ Ğ½Ğµ Ğ½Ğ¾Ğ¹!"

    if any(k in t for k in (
        "Ğ±Ğ¾ĞµĞ²Ğ¸Ğº", "Ñ„Ğ¸Ğ»ÑŒĞ¼", "Ğ¼ÑĞ½Ğ»Ğ¸",
        "Ñ€ÑƒĞ±Ğ¸Ğ»Ğ¾Ğ²Ğ¾", "Ğ³Ğ¾Ğ»Ğ»Ğ¸Ğ²ÑƒĞ´", "ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ"
    )):
        m = _pick(ACTION)
        return f"{m['title']} ({m['year']}) ğŸ’£ ĞŸĞ¸Ğ·Ğ´Ğ°Ñ‚Ğ¾! ĞœÑĞ½Ğ»Ğ¸"

    if any(k in t for k in (
        "Ñ€ÑĞ¿", "Ñ€ĞµĞ¿", "Ñ‚Ñ€ÑĞ¿", "Ñ‚Ñ€ĞµĞ¿",
        "Ğ¼ÑƒĞ·Ğ¾Ğ½", "Ğ¼ÑƒĞ·Ñ‹ĞºĞ°", "Ğ¼ÑƒĞ·Ğ»Ğ¾",
        "Ñ‚Ñ€ĞµĞº", "Ñ‚Ñ€ĞµĞºĞ°Ğ½",
        "Ñ…Ğ¸Ğ¿-Ñ…Ğ¾Ğ¿", "Ñ…Ğ¸Ğ¿Ñ…Ğ¾Ğ¿"
    )):
        r = _pick(RAP)
        return f"{r['artist']} â€” {r['title']} ğŸ’© Ğ”Ñ‘ÑˆĞµĞ²Ğ¾, Ğ½Ğ¾ ĞºĞ°Ñ‡Ğ°ĞµÑ‚!"

    return None

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 5. GPT-ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ (ÑÑ‚Ñ€Ğ¾Ğ³Ğ¸Ğ¹) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def detect_topic(text: str) -> str:
    """
    Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚: BOOK / MOVIE / RAP / NONE
    Ğ Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ğ¢ĞĞ›Ğ¬ĞšĞ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ÑĞ²Ğ½Ğ¾Ğµ ĞºĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ ÑĞ»Ğ¾Ğ²Ğ¾.
    """
    sys = (
        "Ğ’ĞµÑ€Ğ½Ğ¸ Ñ€Ğ¾Ğ²Ğ½Ğ¾ Ğ¾Ğ´Ğ½Ğ¾ ÑĞ»Ğ¾Ğ²Ğ¾: BOOK, MOVIE, RAP Ğ¸Ğ»Ğ¸ NONE.\n"
        "BOOK, ĞµÑĞ»Ğ¸ Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚: Ñ„ÑĞ½Ñ‚ĞµĞ·Ğ¸, Ñ„ĞµĞ½Ñ‚ĞµĞ·Ğ¸, ĞºĞ½Ğ¸Ğ³Ğ°, ĞºĞ½Ğ¸Ğ³Ğ¸, ÑĞµÑ€ÑŒĞµĞ·Ğ½Ğ°Ñ Ğ»Ğ¸Ñ‚ĞµÑ€Ğ°Ñ‚ÑƒÑ€Ğ°.\n"
        "MOVIE, ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ: Ğ±Ğ¾ĞµĞ²Ğ¸Ğº, Ñ„Ğ¸Ğ»ÑŒĞ¼, Ğ¼ÑĞ½Ğ»Ğ¸, Ñ€ÑƒĞ±Ğ¸Ğ»Ğ¾Ğ²Ğ¾, Ğ³Ğ¾Ğ»Ğ»Ğ¸Ğ²ÑƒĞ´, ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ñ.\n"
        "RAP, ĞµÑĞ»Ğ¸: Ñ€ÑĞ¿, Ñ€ĞµĞ¿, Ñ‚Ñ€ÑĞ¿, Ñ‚Ñ€ĞµĞ¿, Ğ¼ÑƒĞ·Ğ¾Ğ½, Ğ¼ÑƒĞ·Ñ‹ĞºĞ°, Ğ¼ÑƒĞ·Ğ»Ğ¾, Ñ‚Ñ€ĞµĞº, Ñ‚Ñ€ĞµĞºĞ°Ğ½, Ñ…Ğ¸Ğ¿-Ñ…Ğ¾Ğ¿, Ñ…Ğ¸Ğ¿Ñ…Ğ¾Ğ¿.\n"
        "Ğ˜Ğ½Ğ°Ñ‡Ğµ Ğ¾Ñ‚Ğ²ĞµÑ‚ÑŒ NONE. ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²."
    )
    resp = await asyncio.to_thread(
        client.chat.completions.create,
        model="gpt-4o",
        messages=[{"role": "system", "content": sys},
                  {"role": "user",   "content": text}],
        temperature=0
    )
    return resp.choices[0].message.content.strip().upper()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 6. Ğ‘ĞµÑ€Ñ‘Ğ¼ Ğ¿Ñ€ĞµĞ´Ğ¼ĞµÑ‚ Ğ¸Ğ· ÑĞ¿Ğ¸ÑĞºĞ° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def pick_item(label: str) -> str | None:
    if label == "BOOK":
        b = _pick(FANTASY); return f"Â«{b['title']}Â» â€” {b['author']}"
    if label == "MOVIE":
        m = _pick(ACTION);  return f"{m['title']} ({m['year']})"
    if label == "RAP":
        r = _pick(RAP);     return f"{r['artist']} â€” {r['title']}"
    return None

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 7. ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¾Ğµ Ğ¾ÑĞºĞ¾Ñ€Ğ±Ğ»ĞµĞ½Ğ¸Ğµ + ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def craft_insult(item: str) -> str:
    extra = (
        "âœ¦ ĞĞ´Ğ½Ğ¾ Ğ°Ğ³Ñ€ĞµÑÑĞ¸Ğ²Ğ½Ğ¾Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ â‰¤20 ÑĞ»Ğ¾Ğ².\n"
        "âœ¦ Ğ’ÑÑ‚Ğ°Ğ²ÑŒ Ñ€ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ Ğ² Ñ‚ĞµĞºÑÑ‚.\n"
        "âœ¦ Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸ Ğ¾Ğ´Ğ½Ğ¸Ğ¼ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸Ğ·: ğŸ’£ ğŸ’° ğŸ¤¡ ğŸ’© ğŸ˜ˆ ğŸ”¥ ğŸ” ğŸ’ ğŸš¬ ğŸ¾ ğŸš— ğŸ¤‘.\n"
        "âœ¦ ĞĞ¸ĞºĞ°ĞºĞ¸Ñ… Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²."
    )
    resp = await asyncio.to_thread(
        client.chat.completions.create,
        model="gpt-4o",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "system", "content": extra},
            {"role": "user",   "content": f"Ğ ĞµĞºĞ¾Ğ¼ĞµĞ½Ğ´Ğ°Ñ†Ğ¸Ñ: {item}"}
        ],
        max_tokens=40,
        temperature=1.0
    )
    return resp.choices[0].message.content.strip()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 8. Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def cosine_similarity(a, b):
    dot = sum(x*y for x,y in zip(a,b))
    na  = math.sqrt(sum(x*x for x in a))
    nb  = math.sqrt(sum(y*y for y in b))
    return dot/(na*nb) if na and nb else 0.0

async def summarize(history):
    text = "".join(f"{m['role']}: {m['content']}\n" for m in history)
    resp = await asyncio.to_thread(
        client.chat.completions.create,
        model=MODEL,
        messages=[
            {"role": "system", "content": "Ğ¡Ğ¾ĞºÑ€Ğ°Ñ‚Ğ¸ Ğ´Ğ¾ ÑÑƒÑ‚Ğ¸."},
            {"role": "user",   "content": text}
        ],
        temperature=0.3,
        max_tokens=MAX_SUMMARY_LEN
    )
    return resp.choices[0].message.content.strip()

async def save_embedding(text, context):
    resp = await asyncio.to_thread(
        client.embeddings.create,
        model="text-embedding-ada-002",
        input=text
    )
    context.chat_data["last_bot_embedding"] = resp.data[0].embedding

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 9. Ğ“Ğ»Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ñ…ĞµĞ½Ğ´Ğ»ĞµÑ€ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    msg = update.message
    if not msg or not msg.text:
        return

    # Ğ¾Ñ‚ÑĞµĞ¸Ğ²Ğ°ĞµĞ¼ ÑÑ‚Ğ°Ñ€Ğ¾Ğµ
    when = msg.date.replace(tzinfo=timezone.utc)
    if when < STARTUP_TIME:
        return

    text = msg.text.strip()

    # â‘  keyword-Ñ„Ğ¾Ğ»Ğ±ÑĞº
    kw_reply = insult_with_rec_keywords(text)
    if kw_reply:
        await msg.reply_text(kw_reply)
        return

    # â‘¡ GPT-ĞºĞ»Ğ°ÑÑĞ¸Ñ„Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€
    label = await detect_topic(text)
    if label != "NONE":
        item = pick_item(label)
        if item:
            reply = await craft_insult(item)
            await msg.reply_text(reply)
            return

    # â‘¢ Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° (Ñ€ĞµĞ¿Ğ»Ğ°Ğ¹/ÑƒĞ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ/ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚)
    now          = datetime.now(timezone.utc)
    bot_id       = context.bot.id
    bot_username = context.bot.username or ""

    is_reply   = msg.reply_to_message and msg.reply_to_message.from_user.id == bot_id
    is_mention = any(
        ent.type == MessageEntity.MENTION and
        text[ent.offset:ent.offset+ent.length].lower() == f"@{bot_username.lower()}"
        for ent in (msg.entities or [])
    )
    is_name    = bool(re.search(r"\b(?:Ğ±Ğ¾Ñ‚|Ñ€Ğ¾Ğ±Ğ¾Ñ‚)\b", text, re.IGNORECASE))
    last_ts    = context.chat_data.get("last_bot_ts")
    is_context = last_ts and (now - last_ts) <= timedelta(seconds=REPLY_WINDOW)
    if not (is_reply or is_mention or is_name or is_context):
        return

    # ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ½Ğ°Ñ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ
    if is_context and not (is_reply or is_mention or is_name):
        last_emb = context.chat_data.get("last_bot_embedding")
        if last_emb:
            emb_resp = await asyncio.to_thread(
                client.embeddings.create,
                model="text-embedding-ada-002",
                input=text
            )
            if cosine_similarity(emb_resp.data[0].embedding, last_emb) < CONTEXT_SIM_THRES:
                return

    history = context.chat_data.get("history", [])
    history.append({"role": "user", "content": text})
    summary = context.chat_data.get("summary", "")

    if len(history) > MAX_HISTORY:
        summary_part = await summarize(history[:-MAX_HISTORY])
        summary = f"{summary}\n{summary_part}".strip() if summary else summary_part
        context.chat_data["summary"] = summary
        history = history[-MAX_HISTORY:]

    messages = [{"role": "system", "content": SYSTEM_PROMPT}]
    if summary:
        messages.append({"role": "system", "content": f"Ğ ĞµĞ·ÑĞ¼Ğµ: {summary}"})
    messages += history

    resp = await asyncio.to_thread(
        client.chat.completions.create,
        model=MODEL,
        messages=messages,
        max_tokens=MAX_TOKENS,
        temperature=TEMPERATURE
    )
    reply = resp.choices[0].message.content
    await msg.reply_text(reply)

    # ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚
    history.append({"role": "assistant", "content": reply})
    context.chat_data["history"]     = history[-MAX_HISTORY:]
    context.chat_data["last_bot_ts"] = datetime.now(timezone.utc)
    asyncio.create_task(save_embedding(reply, context))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10. Ğ—Ğ°Ğ¿ÑƒÑĞº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
def main():
    app = ApplicationBuilder().token(TELEGRAM_TOKEN).build()
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    print("Ğ‘Ğ¾Ñ‚ Ğ“Ğ»ĞµĞ± ĞšĞ¾Ñ‚Ğ¾Ğ² Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½â€¦")
    app.run_polling()

if __name__ == "__main__":
    main()
